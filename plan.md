# plan.md 실행 계획: AI 기반 마인드맵 자동 생성 웹서비스 MVP

## 1) 요약
본 계획은 PRD의 MVP 범위를 기준으로, `비회원 체험 + 로컬 저장`, `비공개 난수 링크 공유`, `PNG 우선 내보내기`를 기본 정책으로 고정한 구현 계획이다.  
핵심 목표는 `주제 입력 → AI 생성 → 즉시 편집 → 공유/내보내기`의 저마찰 흐름을 1차 출시 가능한 품질로 완성하는 것이다.

## 2) 최종 결정(고정)
1. 로그인/저장: 비회원 체험, 기본 저장은 브라우저 로컬(IndexedDB).
2. 공유: 비공개 난수 링크(unguessable token) 방식.
3. 내보내기: PNG를 MVP 우선 제공.
4. 협업 편집/고급 리서치 자동화는 MVP 제외.
5. 전문 자문으로 오해 방지 문구를 생성 결과 화면에 고정 노출.

## 3) 구현 아키텍처(결정 완료)
1. 개발 환경 관리: `Docker`
2. 프론트엔드: `React.js + TypeScript`
3. 백엔드: `FastAPI`
4. 마인드맵 렌더링/편집: 노드 트리 기반 캔버스(추가/삭제/이름변경/정렬).
5. AI 생성: 서버 API에서 LLM 호출 후 정규화된 트리 JSON 반환.
6. 기본 저장: 클라이언트 로컬 저장소.
7. 공유 링크 생성 시에만 서버 저장(스냅샷 문서 + 토큰 매핑).
8. PNG 내보내기: 클라이언트 캡처 기반 생성.
9. 관측성: 핵심 이벤트(생성, 편집, 공유, 내보내기) 수집.

## 4) 공용 API/인터페이스/타입 변경사항
### API
1. `POST /api/v1/mindmaps/generate`
   - 요청: `{ topic: string, purpose?: string, audience?: string, perspective?: string, depth?: "shallow"|"medium"|"deep", tone?: string }`
   - 응답: `{ map: MindmapDoc, qualityHints: string[], disclaimers: string[] }`
2. `POST /api/v1/mindmaps/share`
   - 요청: `{ map: MindmapDoc, title?: string }`
   - 응답: `{ shareUrl: string, token: string, expiresAt: string }`
3. `GET /api/v1/share/:token`
   - 응답: `{ map: MindmapDoc, title?: string, createdAt: string }`

### 프론트엔드 라우트
1. `/` 입력/생성 시작
2. `/map` 편집 화면
3. `/s/[token]` 공유 링크 읽기 전용 화면

### 핵심 타입
1. `MindmapDoc`: `{ id: string, topic: string, nodes: MindmapNode[], createdAt: string, updatedAt: string, version: number }`
2. `MindmapNode`: `{ id: string, parentId: string|null, title: string, order: number, depth: number, tags?: string[] }`
3. `QualityHint`: 누락 가능 영역 표시용 메타 데이터(예: “추가 고려”).

## 5) 워크스트림별 To-do
### 프론트엔드
- [ ] 홈 화면 입력 폼 구현(필수 topic + 선택 파라미터).
- [ ] 생성 진행 상태 UI(로딩, 실패 재시도, 완료 전환).
- [ ] 마인드맵 편집 UI(노드 추가/삭제/이름변경/정렬).
- [ ] “추가 고려” 노드/힌트 시각화.
- [ ] 로컬 저장 자동화(초기 로드, 자동 저장, 복구).
- [ ] PNG 내보내기 버튼 및 다운로드 UX.
- [ ] 공유 링크 생성/복사 UX.
- [ ] 안내 문구(비전문 자문, 정확성 주의) 고정 노출.
- [ ] 모바일 반응형 레이아웃 최적화.

### 백엔드/API
- [ ] `generate` 엔드포인트 구현(입력 검증 포함).
- [ ] LLM 응답을 `MindmapDoc`으로 정규화하는 변환기 구현.
- [ ] 공유 스냅샷 저장소 및 토큰 생성 로직 구현.
- [ ] `share/:token` 조회 API 구현(만료 검사 포함).
- [ ] 공통 에러 스키마 정의 및 적용.
- [ ] 요청 제한(Rate limit)과 기본 보안 헤더 적용.
- [ ] 서버 로그에 민감 입력 마스킹 처리.
- [ ] 기타 보안 사항 확인(예: SQL Injection 등).

### AI/프롬프트
- [ ] 시스템 프롬프트 템플릿 작성(구조화된 트리 출력 강제).
- [ ] 카테고리 누락 완화 규칙(대표 가지 + 추가 고려 가지) 반영.
- [ ] 깊이(`shallow/medium/deep`)별 노드 수 가이드 설계.
- [ ] 환각/과잉 세분화 억제 후처리 규칙 구현.
- [ ] 실패/저품질 시 재생성 정책(1회 자동 보정) 적용.

### 데이터/보안/정책
- [ ] 로컬 저장 데이터 스키마 버전 관리(`version`) 도입.
- [ ] 공유 스냅샷 TTL 정책 적용(기본 7일 만료).
- [ ] 개인정보/민감정보 경고 및 공유 범위 안내 문구 확정.
- [ ] 삭제 정책 문서화(로컬 삭제, 공유 링크 만료/삭제).

### QA/분석/운영
- [ ] 이벤트 정의서 작성(`generate_start/success/fail`, `edit`, `share_create`, `export_png`).
- [ ] 핵심 퍼널 대시보드 구성(생성→편집→공유/내보내기 전환).
- [ ] E2E 시나리오 자동화(핵심 사용자 여정).
- [ ] 장애 대응 플레이북 작성(LLM 지연/실패, 공유 API 장애).

## 6) 테스트 케이스 및 시나리오
1. 생성 정상: topic만 입력 시 2초 내 로딩 시작, 구조화 트리 반환.
2. 생성 품질: 각 깊이 옵션별 최대/최소 노드 수 규칙 준수.
3. 편집 기능: 노드 CRUD 후 새로고침 시 로컬 복구 정상.
4. 공유 링크: 생성된 토큰 URL로 읽기 전용 조회 성공.
5. 공유 보안: 임의 토큰 접근 시 404 또는 만료 응답.
6. 내보내기: PNG 파일 생성 및 주요 노드 누락 없이 저장.
7. 실패 복구: LLM 타임아웃 시 사용자 재시도 동선 정상.
8. 반응형: 모바일에서 입력/생성/편집 핵심 동선 동작.
9. 안전성: 안내 문구 항상 노출, API 로그 민감정보 마스킹 확인.

## 7) 실행 순서(의존성 반영)
1. 공통 타입/스키마 정의(`MindmapDoc`, `MindmapNode`, 에러 스키마).
2. AI 생성 API + 정규화기 우선 구현.
3. 프론트 홈/생성/편집 최소 기능 연결.
4. 로컬 저장 및 자동 복구 연결.
5. 공유 API/링크 페이지 구현.
6. PNG 내보내기 구현.
7. 분석 이벤트/대시보드/테스트 자동화 완료.
8. 성능/보안/문구 점검 후 MVP 릴리스.

## 8) 수용 기준(Acceptance Criteria)
1. 비회원 사용자가 1분 내 첫 마인드맵 생성 가능.
2. 생성 후 편집 가능한 트리 형태가 항상 제공됨.
3. 공유 링크 생성 성공률 99% 이상(서버 오류 제외).
4. PNG 내보내기 성공률 99% 이상.
5. PRD 성공지표 측정에 필요한 이벤트가 누락 없이 수집됨.

## 9) 명시적 가정 및 기본값
1. MVP 기술 스택은 `React.js + TypeScript + FastAPI`를 기본으로 한다.
2. 데이터 영속은 기본 로컬 저장이며, 서버 저장은 공유 시점에 한정한다.
3. 공유 스냅샷 만료는 7일 기본값을 사용한다.
4. 다국어는 MVP 제외, 한국어 우선.
5. PDF 내보내기는 후속 릴리스로 이관한다.